# Internationalization (i18n) Guide

**Translation management for IOTA SDK using TOML files.**

## Overview

IOTA SDK supports multiple languages through TOML translation files:
- **Languages**: English (`en.toml`), Russian (`ru.toml`), Uzbek (`uz.toml`)
- **Location**: `modules/{module}/presentation/locales/`
- **Format**: Hierarchical TOML structure
- **Validation**: `make check tr`

## File Structure

### Location

```
modules/{module}/presentation/locales/
├── en.toml   # English translations
├── ru.toml   # Russian translations
└── uz.toml   # Uzbek translations
```

### Hierarchical Structure

```toml
# Module-level namespace
[ModuleName]

# Common translations
Common.Save = "Save"
Common.Cancel = "Cancel"
Common.Delete = "Delete"

# Entity-specific
Entities.Title = "Entities"
Entities.Create = "Create Entity"
Entities.Edit = "Edit Entity"

# Form fields
Form.Name = "Name"
Form.Description = "Description"
Form.Status = "Status"

# Enums (IMPORTANT pattern)
[ModuleName.Enums]

[ModuleName.Enums.Status]
ACTIVE = "Active"
PENDING = "Pending"
INACTIVE = "Inactive"

[ModuleName.Enums.Priority]
HIGH = "High"
MEDIUM = "Medium"
LOW = "Low"
```

## Key Naming Rules

### Reserved Keywords

**NEVER use these as top-level keys** (TOML reserved):
- `OTHER`
- `ID`
- `DESCRIPTION`
- `DATE`
- `TYPE`

**Instead, prefix with context**:
- `OTHER` → `OTHER_STATUS` or `Status.OTHER`
- `ID` → `ENTITY_ID` or `Form.ID`
- `DESCRIPTION` → `DESC_TEXT` or `Form.Description`

### Naming Conventions

**Good Keys**:
```toml
Common.Save = "Save"
Entities.Title = "Entities"
Form.FirstName = "First Name"
Enums.Status.ACTIVE = "Active"
Messages.Success = "Operation successful"
```

**Bad Keys**:
```toml
OTHER = "Other"        # Reserved!
ID = "Identifier"      # Reserved!
save = "Save"          # Inconsistent casing
first-name = "Name"    # Use dots for hierarchy
```

## Enum Pattern

**Critical for status/type fields**:

```toml
[ModuleName.Enums.Status]
ACTIVE = "Active"
PENDING = "Pending"
COMPLETED = "Completed"
CANCELLED = "Cancelled"

[ModuleName.Enums.Priority]
HIGH = "High"
MEDIUM = "Medium"
LOW = "Low"

[ModuleName.Enums.Role]
ADMIN = "Administrator"
MANAGER = "Manager"
USER = "User"
```

**Usage in code**:

```go
// In template
@badge.New(badge.Props{
    Variant: getVariant(entity.Status()),
}) {
    { pageCtx.T("ModuleName.Enums.Status." + entity.Status()) }
}

// Result: "Active" (or Russian/Uzbek equivalent)
```

## Multi-Language Workflow

### Always Edit All Languages

**Critical Rule**: When adding/modifying translations, **update ALL three files**:

1. **en.toml** - English (primary)
2. **ru.toml** - Russian
3. **uz.toml** - Uzbek

### Example: Adding New Translation

**en.toml**:
```toml
[Vehicles]
Title = "Vehicles"
Create = "Create Vehicle"
Edit = "Edit Vehicle"
Delete = "Delete Vehicle"

[Vehicles.Form]
LicensePlate = "License Plate"
Model = "Model"
Year = "Year"

[Vehicles.Enums.TruckStatus]
ACTIVE = "Active"
MAINTENANCE = "Maintenance"
RETIRED = "Retired"
```

**ru.toml**:
```toml
[Vehicles]
Title = "Транспортные средства"
Create = "Создать транспорт"
Edit = "Редактировать транспорт"
Delete = "Удалить транспорт"

[Vehicles.Form]
LicensePlate = "Номерной знак"
Model = "Модель"
Year = "Год"

[Vehicles.Enums.TruckStatus]
ACTIVE = "Активный"
MAINTENANCE = "На обслуживании"
RETIRED = "Списан"
```

**uz.toml**:
```toml
[Vehicles]
Title = "Transport vositalari"
Create = "Transport yaratish"
Edit = "Transportni tahrirlash"
Delete = "Transportni o'chirish"

[Vehicles.Form]
LicensePlate = "Davlat raqami"
Model = "Model"
Year = "Yil"

[Vehicles.Enums.TruckStatus]
ACTIVE = "Faol"
MAINTENANCE = "Ta'mirda"
RETIRED = "Yo'qotilgan"
```

## Validation

### Check Translation Consistency

**Always run after changes**:

```bash
make check tr
```

**What it validates**:
- All keys exist in all languages
- No missing translations
- No extra keys in one language
- Structure consistency across files

**Example errors**:

```
Error: Key "Vehicles.Create" exists in en.toml but missing in ru.toml
Error: Key "Vehicles.Form.LicensePlate" exists in ru.toml but missing in uz.toml
Error: Reserved keyword "OTHER" used as top-level key in en.toml
```

### Fix Validation Errors

1. **Missing keys**: Add to the language file
2. **Extra keys**: Remove or add to other languages
3. **Reserved keywords**: Rename with prefix or nest properly

## Usage in Code

### In Templates

```go
// Simple translation
{ pageCtx.T("ModuleName.Title") }

// With enum
{ pageCtx.T("ModuleName.Enums.Status." + entity.Status()) }

// In components
@button.Primary(button.Props{}) {
    { pageCtx.T("Common.Save") }
}

// In form labels
@input.Text(&input.Props{
    Label: pageCtx.T("Form.FirstName"),
    Placeholder: pageCtx.T("Form.EnterFirstName"),
})
```

### In Controllers

```go
pageCtx := composables.UsePageCtx(r.Context())

// Get translation
title := pageCtx.T("ModuleName.Title")

// Use in flash messages
shared.SetFlash(w, "success", pageCtx.T("Messages.SaveSuccess"))
```

### In ViewModels

```go
type EntityViewModel struct {
    ID          string
    Name        string
    StatusText  string  // Store key, not translated value
}

func NewEntityViewModel(entity domain.Entity) *EntityViewModel {
    return &EntityViewModel{
        ID:         entity.ID().String(),
        Name:       entity.Name(),
        StatusText: "ModuleName.Enums.Status." + entity.Status(),
    }
}
```

**Then in template**:

```go
{ pageCtx.T(vm.StatusText) }
```

## Common Patterns

### Form Validation Messages

```toml
[Validation]
Required = "This field is required"
Invalid = "Invalid value"
TooShort = "Value is too short"
TooLong = "Value is too long"
InvalidEmail = "Invalid email address"
InvalidPhone = "Invalid phone number"

[Validation.Field]
Name = "Name is required"
Email = "Email is required and must be valid"
```

### Success/Error Messages

```toml
[Messages]
SaveSuccess = "Saved successfully"
UpdateSuccess = "Updated successfully"
DeleteSuccess = "Deleted successfully"
SaveError = "Failed to save"
NotFound = "Record not found"
Forbidden = "You don't have permission"
```

### Common UI Elements

```toml
[Common]
Save = "Save"
Cancel = "Cancel"
Delete = "Delete"
Edit = "Edit"
View = "View"
Create = "Create"
Back = "Back"
Next = "Next"
Previous = "Previous"
Search = "Search"
Filter = "Filter"
Export = "Export"
Import = "Import"
```

## Best Practices

### Key Organization

**Group related translations**:

```toml
# Good: Hierarchical grouping
[Entities.List]
Title = "Entity List"
NoResults = "No entities found"
LoadMore = "Load More"

[Entities.Form]
Create = "Create Entity"
Edit = "Edit Entity"
FieldName = "Name"

# Bad: Flat structure
Entities.ListTitle = "Entity List"
Entities.ListNoResults = "No entities found"
Entities.FormCreate = "Create Entity"
```

### Consistent Terminology

**Use same terms across languages**:

```toml
# Good: Consistent
Common.Save = "Save"
Form.SaveButton = "Save"

# Bad: Inconsistent
Common.Save = "Save"
Form.SaveButton = "Submit"
```

### Enum Value Mapping

**Match backend enum values**:

```go
// Backend enum
const (
    StatusActive   Status = "ACTIVE"
    StatusPending  Status = "PENDING"
    StatusInactive Status = "INACTIVE"
)
```

```toml
# Translation keys match enum values
[Enums.Status]
ACTIVE = "Active"
PENDING = "Pending"
INACTIVE = "Inactive"
```

## Checklist

### Before Committing Translations

- [ ] Updated all 3 language files (en, ru, uz)
- [ ] Keys are hierarchically organized
- [ ] No reserved keywords used
- [ ] Enum pattern followed for statuses/types
- [ ] Ran `make check tr` and passed
- [ ] Consistent terminology across languages
- [ ] No hardcoded strings left in code

### Common Mistakes

**Don't**:
- Use reserved keywords (`OTHER`, `ID`, `DESCRIPTION`)
- Edit only one language file
- Hardcode strings in templates/controllers
- Skip `make check tr` validation
- Use inconsistent key naming
- Mix translation keys with translated values in code

**Do**:
- Update all language files together
- Use hierarchical key structure
- Follow enum pattern for statuses
- Run validation after changes
- Use consistent naming conventions
- Store translation keys in ViewModels, translate in templates

## Troubleshooting

### Key Not Found Error

**Symptom**: Missing translation in UI, shows key instead

**Solution**:
1. Check key exists in all 3 files
2. Verify key casing (exact match required)
3. Run `make check tr` to find issues

### Reserved Keyword Error

**Symptom**: `make check tr` fails with reserved keyword error

**Solution**:
1. Rename key with prefix: `OTHER` → `OTHER_STATUS`
2. Or nest properly: `Status.OTHER`
3. Re-run validation

### Inconsistent Structure

**Symptom**: Validation fails with structure mismatch

**Solution**:
1. Compare all 3 files
2. Ensure identical key hierarchy
3. Add missing keys or remove extras
4. Re-run `make check tr`

## Integration with Other Layers

- **Controllers**: Use `pageCtx.T()` for flash messages
- **ViewModels**: Store translation keys, not values
- **Templates**: Translate using `pageCtx.T()`
- **Components**: Pass translated strings as content
