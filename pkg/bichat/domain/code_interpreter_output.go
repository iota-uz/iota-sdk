package domain

import (
	"time"

	"github.com/google/uuid"
)

// CodeInterpreterOutput represents a file generated by code interpreter execution.
// These files are downloaded from OpenAI and stored using the FileStorage interface.
type CodeInterpreterOutput struct {
	// ID is the unique identifier for this output
	ID uuid.UUID `json:"id"`

	// MessageID is the foreign key to the message that generated this output
	MessageID uuid.UUID `json:"message_id"`

	// Name is the filename (e.g., "chart.png", "data.csv")
	Name string `json:"name"`

	// MimeType is the MIME type (e.g., "image/png", "text/csv", "application/pdf")
	MimeType string `json:"mime_type"`

	// URL is the public download URL from our FileStorage
	URL string `json:"url"`

	// Size is the file size in bytes
	Size int64 `json:"size"`

	// CreatedAt is when the output was created
	CreatedAt time.Time `json:"created_at"`
}

// CodeInterpreterOutputOption is a functional option for configuring a CodeInterpreterOutput.
type CodeInterpreterOutputOption func(*CodeInterpreterOutput)

// WithOutputID sets the output ID.
func WithOutputID(id uuid.UUID) CodeInterpreterOutputOption {
	return func(o *CodeInterpreterOutput) {
		o.ID = id
	}
}

// WithOutputCreatedAt sets the created timestamp.
func WithOutputCreatedAt(t time.Time) CodeInterpreterOutputOption {
	return func(o *CodeInterpreterOutput) {
		o.CreatedAt = t
	}
}

// NewCodeInterpreterOutput creates a new code interpreter output.
func NewCodeInterpreterOutput(
	messageID uuid.UUID,
	name string,
	mimeType string,
	url string,
	size int64,
	opts ...CodeInterpreterOutputOption,
) *CodeInterpreterOutput {
	output := &CodeInterpreterOutput{
		ID:        uuid.New(),
		MessageID: messageID,
		Name:      name,
		MimeType:  mimeType,
		URL:       url,
		Size:      size,
		CreatedAt: time.Now(),
	}

	for _, opt := range opts {
		opt(output)
	}

	return output
}
